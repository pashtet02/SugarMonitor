<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="parts/headPart :: header"></head>
<body>
<nav th:replace="parts/navbarPart :: navbar"></nav>
<div class="container px-1">
    <h4>SugarMonitor reporting</h4>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button th:class="${dayToDayTabActive} ? 'nav-link active' : 'nav-link'" id="day-to-day-tab" data-bs-toggle="tab" data-bs-target="#day-to-day"
                    type="button" role="tab" aria-controls="day-to-day" th:attr="aria-selected=${dayToDayTabActive} ? 'true' : 'false'">Day to Day
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button th:class="${weekToWeekTabActive} ? 'nav-link active' : 'nav-link'" id="week-to-week-tab" data-bs-toggle="tab" data-bs-target="#week-to-week"
                    type="button" role="tab" aria-controls="week-to-week" th:attr="aria-selected=${weekToWeekTabActive} ? 'true' : 'false'">Week to Week
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button th:class="${generalTabActive} ? 'nav-link active' : 'nav-link'" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button"
                    role="tab" aria-controls="general" th:attr="aria-selected=${generalTabActive} ? 'true' : 'false'">General
            </button>
        </li>
    </ul>


    <!-- Tab panes -->
    <div class="tab-content">
        <div th:class="${dayToDayTabActive} ? 'tab-pane fade show active' : 'tab-pane fade'" id="day-to-day" role="tabpanel" aria-labelledby="day-to-day-tab">
            <div class="card mb-2">
                <form method="GET" action="/report/daytoday">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label for=fromDate class="form-label">From:</label>
                                <input type="date" class="form-control" id="fromDate" name="fromDate">
                            </div>
                            <div class="col-md-3">
                                <label for="toDate" class="form-label">To:</label>
                                <input type="date" class="form-control" id="toDate" name="toDate">
                            </div>
                            <div class="col-md-4 align-self-end align-items-end justify-content-end">
                                <a href="/report/daytoday?generateFor=today" class="btn btn-primary mx-1">Today</a>
                                <a href="/report/daytoday?generateFor=2days" class="btn btn-primary mx-1">For 2 days</a>
                                <a href="/report/daytoday?generateFor=week" class="btn btn-primary mx-1">For week</a>
                                <a href="/report/daytoday?generateFor=month" class="btn btn-primary mx-1">For month</a>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="text-begin">
                                <button class="btn btn-primary" type="submit" id="show-btn">Show</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div th:each="outerMap : ${map}">
                <div class="card mb-2">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${outerMap.key}"></h5>
                        <div id="line-chart"
                             th:attr="data-categories=${outerMap.value.keySet()},
                    data-values=${outerMap.value.values()},
                    data-low-sugar-line=${lowSugarLine},
                    data-high-sugar-line=${highSugarLine}">
                        </div><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script
                                src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
                        <!-- Latest compiled and minified JavaScript -->
                        <script
                                src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
                        <script src="https://code.highcharts.com/highcharts.js"></script>
                        <script src="https://code.highcharts.com/modules/exporting.js"></script>
                        <script>
                            // Iterate through all the sugarMap elements
                            document.querySelectorAll("#line-chart").forEach(function (element) {
                                // Parse the chart data from the HTML data attributes
                                var categories = element.getAttribute("data-categories").split(",");
                                var values = element.getAttribute("data-values").split(",");
                                var lowSugarLine = element.getAttribute("data-low-sugar-line");
                                var highSugarLine = element.getAttribute("data-high-sugar-line");

                                // Convert the values array to numbers
                                for (var i = 0; i < values.length; i++) {
                                    values[i] = parseFloat(values[i]);
                                }

                                // Create the chart
                                Highcharts.chart(element, {
                                    chart: {
                                        type: 'line'
                                    },
                                    legend: {
                                        enabled: false
                                    },
                                    title: {
                                        text: ''
                                    },
                                    credits: {
                                        enabled: false
                                    },
                                    subtitle: {
                                        text: ''
                                    },
                                    xAxis: {
                                        categories: categories,
                                        crosshair: true,
                                    },
                                    yAxis: {
                                        title: {
                                            text: ''
                                        },
                                        plotLines: [{
                                            value: lowSugarLine,
                                            color: '#f75c5c',
                                            dashStyle: 'shortdash',
                                            width: 2,
                                            label: {
                                                text: '',
                                                align: 'center',
                                                style: {
                                                    color: '#f75c5c'
                                                }
                                            }
                                        }, {
                                            value: highSugarLine,
                                            color: '#ffea00',
                                            dashStyle: 'shortdash',
                                            width: 2,
                                            label: {
                                                text: '',
                                                align: 'center',
                                                style: {
                                                    color: '#ffea00'
                                                }
                                            }
                                        }]
                                    },
                                    series: [{
                                        name: '',
                                        data: values,
                                        zones: [{
                                            value: lowSugarLine,
                                            color: '#f75c5c'
                                        }, {
                                            value: highSugarLine,
                                            color: '#94ec7c'
                                        }, {
                                            color: '#ede47d'
                                        }]
                                    }]
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>

        </div>

        <div th:class="${weekToWeekTabActive} ? 'tab-pane fade show active' : 'tab-pane fade'" id="week-to-week" role="tabpanel" aria-labelledby="week-to-week-tab">
            <div class="card mb-2">
                <form method="GET" action="/report/weektoweek">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label for=fromDateWeek class="form-label">From:</label>
                                <input type="date" class="form-control" id="fromDateWeek" name="fromDateWeek">
                            </div>
                            <div class="col-md-3">
                                <label for="toDateWeek" class="form-label">To:</label>
                                <input type="date" class="form-control" id="toDateWeek" name="toDateWeek">
                            </div>
                            <div class="col-md-4 align-items-end justify-content-end">
                                <a href="/report/weektoweek?generateFor=week" class="btn btn-primary mx-1">This week</a>
                                <a href="/report/weektoweek?generateFor=2weeks" class="btn btn-primary mx-1">For 2
                                    weeks</a>
                                <a href="/report/weektoweek?generateFor=month" class="btn btn-primary mx-1">For
                                    month</a>
                                <a href="/report/weektoweek?generateFor=3month" class="btn btn-primary mx-1">For 3
                                    months</a>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-7 align-self-end align-items-end justify-content-end">
                                <input class="form-check-input" type="checkbox" name="lowAlertSoundEnabled"
                                       id="monday" value="monday">
                                <label class="form-check-label" for="monday">
                                    Monday
                                </label>
                                <input class="form-check-input" type="checkbox" name="tuesday"
                                       id="tuesday" value="tuesday">
                                <label class="form-check-label" for="tuesday">
                                    Tuesday
                                </label>
                                <input class="form-check-input" type="checkbox" name="wednesday"
                                       id="wednesday" value="wednesday">
                                <label class="form-check-label" for="wednesday">
                                    Wednesday
                                </label>
                                <input class="form-check-input" type="checkbox" name="thursday"
                                       id="thursday" value="thursday">
                                <label class="form-check-label" for="thursday">
                                    Thursday
                                </label>
                                <input class="form-check-input" type="checkbox" name="friday"
                                       id="friday" value="friday">
                                <label class="form-check-label" for="friday">
                                    Friday
                                </label>
                                <input class="form-check-input" type="checkbox" name="saturday"
                                       id="saturday" value="saturday">
                                <label class="form-check-label" for="saturday">
                                    Saturday
                                </label>
                                <input class="form-check-input" type="checkbox" name="sunday"
                                       id="sunday" value="sunday">
                                <label class="form-check-label" for="sunday">
                                    Sunday
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="text-begin">
                            <button class="btn btn-primary" type="submit" id="show-btn-week">Show</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        </div>

    <div th:class="${generalTabActive} ? 'tab-pane fade show active' : 'tab-pane fade'" id="general" role="tabpanel" aria-labelledby="general-tab">
        <div class="card mb-2">
            <form method="GET" action="/report/general">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for=fromDateGeneral class="form-label">From:</label>
                            <input type="date" class="form-control" id="fromDateGeneral" name="fromDateGeneral">
                        </div>
                        <div class="col-md-3">
                            <label for="toDateGeneral" class="form-label">To:</label>
                            <input type="date" class="form-control" id="toDateGeneral" name="toDateGeneral">
                        </div>
                        <div class="col-md-4 align-self-end align-items-end justify-content-end">
                            <a href="/report/general?generateFor=today" class="btn btn-primary mx-1">Today</a>
                            <a href="/report/general?generateFor=2days" class="btn btn-primary mx-1">For 2 days</a>
                            <a href="/report/general?generateFor=week" class="btn btn-primary mx-1">For week</a>
                            <a href="/report/general?generateFor=month" class="btn btn-primary mx-1">For month</a>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="text-begin">
                            <button class="btn btn-primary" type="submit" id="show-btn-general">Show</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div id="pieChart"></div>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script
                                src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
                        <!-- Latest compiled and minified JavaScript -->
                        <script
                                src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
                        <script src="https://code.highcharts.com/highcharts.js"></script>
                        <script src="https://code.highcharts.com/modules/exporting.js"></script>
                        <script>
                            // HighCharts pie chart
                            Highcharts.chart('pieChart', {
                                chart: {
                                    type: 'pie'
                                },
                                title: {
                                    text: '[[${report.name}]]'
                                },
                                credits: {
                                    enabled: false
                                },
                                series: [{
                                    name: 'Percents',
                                    data: [{
                                        name: 'Low',
                                        y: [[${report.lowSugarPercentage}]],
                                        color: '#FF0000'
                                    }, {
                                        name: 'In Range',
                                        y: [[${report.inRangeSugarPercentage}]],
                                        color: '#00FF00'
                                    }, {
                                        name: 'High',
                                        y: [[${report.highSugarPercentage}]],
                                        color: '#FFFF00'
                                    }]
                                }]
                            });
                        </script>
                    </div>
                    <div class="col-md-6">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Range</th>
                                <th>% of Readings</th>
                                <th># of Readings</th>
                                <th>Average</th>
                                <th>Median</th>
                                <th>Standard Deviation</th>
                                <th>A1c estimation*</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td th:text="'Low (<' + ${profile.getLowerBoundLimit()} + ')'">-</td>
                                <td th:text="${report.getLowSugarPercentage()}">-</td>
                                <td th:text="${report.getNumOfLowEntries()}">-</td>
                                <td th:text="${report.getAverageLow()}">-</td>
                                <td th:text="${report.getMedianLow()}">-</td>
                                <td th:text="${report.getStdDevLow()}">-</td>
                                <td th:text="${report.getHbA1cLow()}">-</td>
                            </tr>
                            <tr>
                                <td th:text="'In Range'"></td>
                                <td th:text="${report.getInRangeSugarPercentage()}">-</td>
                                <td th:text="${report.getNumOfInRangeEntries()}">-</td>
                                <td th:text="${report.getAverageInRange()}">-</td>
                                <td th:text="${report.getMedianInRange()}">-</td>
                                <td th:text="${report.getStdDevInRange()}">-</td>
                                <td th:text="${report.getHbA1cInRange()}">-</td>
                            </tr>
                            <tr>
                                <td th:text="'High (>' + ${profile.getHighBoundLimit()} + ')'">-</td>
                                <td th:text="${report.getHighSugarPercentage()}">-</td>
                                <td th:text="${report.getNumOfHighEntries()}">-</td>
                                <td th:text="${report.getAverageHigh()}">-</td>
                                <td th:text="${report.getMedianHigh()}">-</td>
                                <td th:text="${report.getStdDevHigh()}">-</td>
                                <td th:text="${report.getHbA1cHigh()}">-</td>
                            </tr>
                            <tr>
                                <td>Overall</td>
                                <td>100%</td>
                                <td th:text="${report.getTotalEntries()}">-</td>
                                <td th:text="${report.getAverageTotal()}">-</td>
                                <td th:text="${report.getMedianInTotal()}">-</td>
                                <td th:text="${report.getStdDevTotal()}">-</td>
                                <td th:text="${report.getHbA1cTotal()}">-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<!-- Highcharts library -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

</body>
</html>